webpackJsonp([17],{Iaeq:function(e,t,r){(e.exports=r("UTlt")(!1)).push([e.i,"\n.text-center[data-v-19e62388] {\n  margin-top: 15px;\n  text-align: center;\n}\n.filter-container[data-v-19e62388] {\n  margin-bottom: 10px;\n}\n",""])},KYqV:function(e,t,r){var a=r("Iaeq");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("8bSs")("1978ade6",a,!0)},cT3z:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("vLgD");var o={name:"ServerReport",data:function(){return{reportList:[],hostList:[],items:"",dateValue:"",reportTypeList:[{value:"ALL",name:"全部"},{value:"SERVER_DAILY_REPORT",name:"运维日报"},{value:"DB_DAILY_REPORT",name:"数据库日报"},{value:"SERVER_REPORT",name:"临时报告"}],addReportTypeList:[{value:"SERVER_DAILY_REPORT",name:"运维日报"},{value:"DB_DAILY_REPORT",name:"数据库日报"},{value:"SERVER_REPORT",name:"临时报告"}],reportPeriod:[{value:3600,name:"1小时内"},{value:21600,name:"6小时内"},{value:43200,name:"12小时内"},{value:86400,name:"24小时内"},{value:604800,name:"一周内"}],totalNum:0,dialogVisibleForAddReport:!1,addReport:{report_name:"",report_type:"",report_hosts:"",report_start_timestamp:"",report_period:""},searchForms:{report_name:"",report_type:"",report_create_time_after:"",report_create_time_before:"",page:""},params:{report_name:"",report_type:"",report_create_time_after:"",report_create_time_before:"",page:1}}},methods:{fetchData:function(){var e,t=this;this.loading=!0,(e=this.params,Object(a.a)({url:"/reports/",method:"get",params:e})).then(function(e){t.reportList=e.results,t.totalNum=e.count,t.loading=!1}),function(e){return Object(a.a)({url:"/zabbixHostList/",method:"get",params:e})}(this.params).then(function(e){t.hostList=e})},downloadAttachment:function(e){window.location.href=e.download_url},handleCurrentChange:function(e){this.params.page=e,this.fetchData()},handleAddBtn:function(){this.dialogVisibleForAddReport=!0},handleCancelAddReport:function(){this.dialogVisibleForAddReport=!1,this.addReport=""},handleFilter:function(){null===this.dateValue||""===this.dateValue||0===this.dateValue.length?(this.searchForms.report_create_time_before="",this.searchForms.report_create_time_after=""):(this.searchForms.report_create_time_before=this.dateValue[1],this.searchForms.report_create_time_after=this.dateValue[0]),this.searchForms.page=1,this.params=this.searchForms,this.fetchData(this.params)},handleDelete:function(e){var t=this;this.$confirm("是否删除 "+e.report_name,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r;(r=e.id,Object(a.a)({url:"/reports/"+r+"/",method:"delete"})).then(function(){t.$message({message:"删除策略成功",type:"success"}),t.fetchData()})}).catch(function(){t.$message({message:"操作失败",type:"error"})})},handleSubmitAdd:function(){var e,t=this,r=this.addReport.report_hosts.join(",");""===this.addReport.report_hosts?this.addReport.report_hosts="":this.addReport.report_hosts=r,(e=this.addReport,Object(a.a)({url:"/reports/",method:"POST",data:e})).then(function(e){t.$message({message:"创建成功",type:"success"}),t.handleCancelAddReport(),t.fetchData()})}},created:function(){this.fetchData()}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{"margin-top":"10px","margin-left":"10px","margin-right":"10px"}},[r("div",[r("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.searchForms.report_type,callback:function(t){e.$set(e.searchForms,"report_type",t)},expression:"searchForms.report_type"}},e._l(e.reportTypeList,function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})}),1),e._v(" "),r("el-date-picker",{attrs:{type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small"},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}}),e._v(" "),r("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"报告名称",size:"small"},model:{value:e.searchForms.report_name,callback:function(t){e.$set(e.searchForms,"report_name",t)},expression:"searchForms.report_name"}}),e._v(" "),r("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-search",plain:""},on:{click:e.handleFilter}},[e._v("Search")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus",plain:""},on:{click:e.handleAddBtn}},[e._v("创建报告")])],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.reportList,"element-loading-text":"Loading..."}},[r("el-table-column",{attrs:{prop:"report_name",label:"报告名",width:"200px",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"report_type",label:"报告类型",align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["SERVER_DAILY_REPORT"===a.report_type?r("div",[e._v("运维日报")]):e._e(),e._v(" "),"DB_DAILY_REPORT"===a.report_type?r("div",[e._v("数据库日报")]):e._e(),e._v(" "),"SERVER_REPORT"===a.report_type?r("div",[e._v("临时报告")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"report_create_time",label:"创建时间",width:"180px",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"report_start_timestamp",label:"报告截止时间",width:"180px",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"report_period",label:"报告周期(s)",align:"center",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return e._l(e.reportPeriod,function(t){return r("div",[a.report_period===t.value?r("span",[e._v(" "+e._s(t.name))]):e._e()])})}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"report_hosts",label:"主机列表",align:"center",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[""===a.report_hosts?r("div",[e._v("all servers")]):e._e(),e._v(" "),e._l(a.report_hosts.split(","),function(t){return r("div",e._l(e.hostList,function(a){return r("div",[t===a.hostid?r("span",[e._v(" "+e._s(a.host))]):e._e()])}),0)})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"report_file",label:"文件名称",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{prop:"",label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(r){return e.downloadAttachment(t.row)}}},[e._v("下载")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.totalNum>=10,expression:"totalNum>=10"}],staticClass:"text-center"},[r("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.totalNum},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),r("el-dialog",{attrs:{title:"添加报告",visible:e.dialogVisibleForAddReport,width:"500px"},on:{"update:visible":function(t){e.dialogVisibleForAddReport=t}}},[r("el-form",{ref:"addReportFile",attrs:{model:e.addReport,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"报告名称",prop:"report_name"}},[r("el-input",{attrs:{placeholder:"请输入报告名称"},model:{value:e.addReport.report_name,callback:function(t){e.$set(e.addReport,"report_name",t)},expression:"addReport.report_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"报告类型"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择报告类型"},model:{value:e.addReport.report_type,callback:function(t){e.$set(e.addReport,"report_type",t)},expression:"addReport.report_type"}},e._l(e.addReportTypeList,function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"主机"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择主机， 不填则默认全部主机"},model:{value:e.addReport.report_hosts,callback:function(t){e.$set(e.addReport,"report_hosts",t)},expression:"addReport.report_hosts"}},e._l(e.hostList,function(e){return r("el-option",{key:e.hostid,attrs:{label:e.name,value:e.hostid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"报告开始时间",prop:"report_start_timestamp"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.addReport.report_start_timestamp,callback:function(t){e.$set(e.addReport,"report_start_timestamp",t)},expression:"addReport.report_start_timestamp"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"报告周期",prop:"report_period"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"","allow-create":"",placeholder:"请输入(单位：s)或选择报告周期"},model:{value:e.addReport.report_period,callback:function(t){e.$set(e.addReport,"report_period",t)},expression:"addReport.report_period"}},e._l(e.reportPeriod,function(e){return r("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})}),1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleCancelAddReport}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmitAdd}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var n=r("/Xao")(o,l,!1,function(e){r("KYqV")},"data-v-19e62388",null);t.default=n.exports}});